ruleset: email_rules
version: "2.0.0"
profile: strict.v2
description: "严格发信规则（需显式启用），提高幂等与可观测性。"

feature_flags:
  enable_new_email_rules: true
  enable_explain: true
  require_sent_mail_guard: true

compatibility:
  backward_compatible: true
  fallback_to_legacy_on_error: true

delivery:
  transport: icloud_smtp
  date_tz: Asia/Shanghai
  subject_template: "全球IVD晨报 - {{date}}"
  from_name: "全球IVD晨报"
  from_env: SMTP_FROM
  to_env: TO_EMAIL
  dedupe_key_template: "{{to}}|{{subject}}|{{date}}"

retry:
  connect_timeout_sec: 10
  max_time_sec: 90
  max_retries: 6
  backoff_initial_sec: 2
  backoff_max_sec: 90

fallback:
  cloud_backup_enabled: true
  cloud_backup_check_sent_mail: true
  cloud_backup_mailbox_env: IMAP_SENT_MAILBOX
  allow_resend_in_replay: false

logging:
  required_fields:
    - run_id
    - profile
    - rules_version
    - mode
    - reason_code
